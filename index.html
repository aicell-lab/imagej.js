<!DOCTYPE html>
<html lang="en">
<head>
<title>ImageJ.JS</title>
<script src="https://cjrtnc.leaningtech.com/4.0/loader.js"></script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
    html,
    body {
      margin: 0;
    }
  
    #container {
      width: 100vw;
      height: 100svh;
    }
  </style>
</head>

<body>
<script type="module">
const baseUrl = location.pathname === "/" ? "/" : location.pathname;
async function applyPatches(){

    function ddlSend()
{
	var downloader = this;
	var headers = {};
	var method = "GET";
	if(downloader.rangeHeader)
		headers["Range"] = downloader.rangeHeader;
	else if(downloader.metaDataOnly)
		headers["Range"] = "bytes=0-0";
  if(this.url.startsWith(`${baseUrl}lib/ImageJ/samples/`)){
      this.url = this.url.replace(`${baseUrl}lib/ImageJ/samples/`, 'https://imagej.net/images/');
  }
	fetch(downloader.url, {"method": method, "mode": "cors", "headers" : headers})
		.then(function(response){
			ddlOnLoad(response, downloader);
		})
		.catch(function(err){
			ddlOnError(downloader, err);
		});
}


    DirectDownloader.prototype.send = ddlSend;
}

await cheerpjInit({
    clipboardMode: "java", // "permission" | "system" | "java"
    javaProperties: [
      "user.dir=/files",
      `plugins.dir=/app${baseUrl}lib/ImageJ/plugins`,
      "useJFileChooser=true"
    ],
    // fetch(){
    //     debugger
    //     return fetch(...arguments);
    // }
});
await applyPatches();
cheerpjCreateDisplay(-1, -1, document.getElementById("container"));
await cheerpjRunJar(`/app${baseUrl}lib/ImageJ/ij.jar`);
// await cheerpjRunMain("net.imagej.Main", `/app${baseUrl}lib/ImageJ/imagej2-cheerpj-0-SNAPSHOT-all.jar`);
 
</script>
<div id="container"></div>
</body>
</html>